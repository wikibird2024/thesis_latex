\section{Cơ sở Lý thuyết về Phần cứng và Kiến trúc Hệ thống Phát hiện Té ngã}
\label{sec:hardware_theory}

Mục này cung cấp kiến thức nền tảng về phần cứng, các loại cảm biến và module truyền thông được sử dụng trong hệ thống phát hiện té ngã.

\subsection{Tổng quan Kiến trúc Hệ thống Phát hiện Té ngã}
Hệ thống phát hiện té ngã hiện đại thường được phân loại thành hai nhóm chính: \textbf{Hệ thống dựa trên Camera} và \textbf{Hệ thống dựa trên Thiết bị đeo}. Báo cáo này tích hợp cả hai, bao gồm các thành phần cốt lõi:
\begin{enumerate}
    \item \textbf{Thiết bị Thu thập Dữ liệu}: Thu thập dữ liệu chuyển động (IMU) và/hoặc hình ảnh (Camera).
    \item \textbf{Máy chủ Xử lý}: Thực hiện các thuật toán học sâu và logic ra quyết định phức tạp.
    \item \textbf{Hệ thống Truyền thông}: Đảm bảo luồng dữ liệu hai chiều và kích hoạt cảnh báo.
\end{enumerate}

\subsection{Cảm biến và Xử lý Dữ liệu Sơ cấp tại biên}

\subsubsection{Vi điều khiển và Xử lý Cục bộ}
\textbf{ESP32 (hoặc ESP32-S3)} được chọn làm bộ điều khiển trung tâm nhờ kiến trúc \textbf{lõi kép Xtensa LX6} (hoặc S3), cho phép xử lý song song. Một lõi được dành riêng cho các tác vụ thời gian thực như đọc và tiền xử lý dữ liệu cảm biến (ví dụ: \textbf{Kalman Filter} để ước tính hướng và trạng thái), trong khi lõi còn lại quản lý các giao tiếp không dây (Wi-Fi, Bluetooth) và giao thức \textbf{MQTT} hoặc \textbf{HTTP}, giảm thiểu độ trễ.

\subsubsection{Cảm biến Đo lường Quán tính (IMU)}
\textbf{IMU (Inertial Measurement Unit)} là thành phần chính trong hệ thống đeo người, cung cấp dữ liệu về động học của cơ thể. IMU tích hợp:
\begin{itemize}
    \item \textbf{Gia tốc kế}: Đo gia tốc tuyến tính. Gia tốc thô được hiệu chuẩn để chuyển từ giá trị số nguyên sang đơn vị thực tế ($g$).
    \item \textbf{Con quay hồi chuyển}: Đo tốc độ góc, dựa trên \textbf{hiệu ứng Coriolis}.
    \item \textbf{Từ kế}: Cung cấp tham chiếu hướng từ trường để hiệu chỉnh sai số trôi của con quay hồi chuyển (thường thông qua thuật toán \textbf{Sensor Fusion} như Bộ lọc Madgwick hoặc Kalman).
\end{itemize}

Dữ liệu thô sau khi xử lý (ví dụ: trung bình hóa) được biểu diễn dưới dạng vector 3D:
\[
\mathbf{a} = [a_x, a_y, a_z], \quad
\boldsymbol{\omega} = [\omega_x, \omega_y, \omega_z]
\]

\paragraph{Phát hiện Té ngã dựa trên Ngưỡng IMU}
Tại tầng vi điều khiển, té ngã được phát hiện sơ bộ bằng cách phân tích sự thay đổi đột ngột của \textbf{Gia tốc Tổng (Magnitude of Acceleration)} và tốc độ góc:
\begin{itemize}
    \item \textbf{Shock Event}: Gia tốc tổng vượt ngưỡng cao ($a_{\text{shock}}$): $\|\mathbf{a}\| > a_{\text{shock}}$.
    \item \textbf{Post-fall State}: Gia tốc tổng sau đó giảm về gần 1g (biểu thị trạng thái nằm ngang) trong khi tốc độ góc có thay đổi lớn.
\end{itemize}
\[
\|\mathbf{a}\| = \sqrt{a_x^2 + a_y^2 + a_z^2}
\]

\subsubsection{Cảm biến Định vị Vị trí (GPS)}
Module GPS (ví dụ: u-blox NEO-6M) sử dụng nguyên lý \textbf{Đo tam giác} để xác định vị trí địa lý của thiết bị dựa trên tín hiệu từ ít nhất bốn vệ tinh. Dữ liệu đầu ra là chuỗi \textbf{NMEA}, cung cấp tọa độ Kinh độ/Vĩ độ và độ cao, là thông tin quan trọng cho dịch vụ cứu hộ khẩn cấp.

\subsection{Hệ thống Camera và Xử lý Máy chủ}

\subsubsection{Hệ thống Camera}
Camera nhúng (\textbf{ESP32-S3 + OV5640 5MP}) cung cấp dữ liệu hình ảnh được nén theo chuẩn \textbf{JPEG}. Dữ liệu này là luồng byte được truyền tải qua Wi-Fi bằng các giao thức như \textbf{RTSP} hoặc \textbf{HTTP/MJPEG stream}, phục vụ cho việc \textbf{Xác minh Hình ảnh} trên máy chủ.

\subsubsection{Kiến trúc Máy chủ Xử lý}
Máy chủ là nơi thực hiện các thuật toán phức tạp như Ước lượng tư thế người (HPE) và Học sâu, đảm bảo độ chính xác cao.
\begin{itemize}
    \item \textbf{Phần cứng}: Sử dụng máy chủ đám mây (AWS, Google Cloud) hoặc máy tính nhúng mạnh mẽ (NVIDIA Jetson Nano) có \textbf{GPU} để tăng tốc tính toán Tensor.
    \item \textbf{Phần mềm Học sâu}: Nền tảng \textbf{TensorFlow/PyTorch} kết hợp với thư viện \textbf{OpenCV}.
    \item \textbf{Xử lý Dữ liệu Lớn}: Máy chủ tiếp nhận luồng dữ liệu \textbf{JSON/MQTT} (từ IMU) và luồng \textbf{JPEG} (từ Camera). Việc tổng hợp và đồng bộ hóa hai luồng dữ liệu này là chìa khóa để xác minh té ngã và giảm thiểu báo động giả (False Positives).
\end{itemize}

\subsection{Hệ thống Truyền thông và Cơ chế Dự phòng}

\subsubsection{Module Truyền thông Đa dạng}
\begin{itemize}
    \item \textbf{Wi-Fi (ESP32)}: Kênh chính để truyền tải dữ liệu dung lượng lớn (video/hình ảnh) và giao tiếp \textbf{MQTT} với máy chủ.
    \item \textbf{Module Di động (4G/LTE - EC800K)}: Đóng vai trò là \textbf{Kênh Dự phòng}. Nó hỗ trợ định vị GPS và quan trọng nhất là kích hoạt \textbf{cuộc gọi khẩn cấp tự động} hoặc gửi \textbf{SMS cảnh báo} bằng \textbf{AT commands}, đảm bảo cảnh báo được gửi đi ngay cả khi mạng Wi-Fi không khả dụng.
\end{itemize}

\subsubsection{Liên kết Tổng thể và Logic Dự phòng}
Hệ thống vận hành theo nguyên lý tích hợp và dự phòng:
\begin{enumerate}
    \item \textbf{Thu thập/Xử lý Sơ cấp}: ESP32 thu thập IMU/Camera và thực hiện phát hiện té ngã dựa trên ngưỡng IMU.
    \item \textbf{Quyết định Truyền thông}: Nếu té ngã được phát hiện, dữ liệu được truyền đến máy chủ qua kênh Wi-Fi (Ưu tiên) hoặc 4G (Dự phòng).
    \item \textbf{Xác minh Máy chủ}: Máy chủ tiến hành phân tích hình ảnh (HPE) kết hợp với dữ liệu IMU để xác minh té ngã (Multi-stage Fall Detection Logic).
    \item \textbf{Kích hoạt Cảnh báo}: Nếu xác nhận té ngã, máy chủ ra lệnh cho ESP32 kích hoạt Module EC800K gửi cảnh báo (SMS/Cuộc gọi), hoàn tất chu trình cứu hộ.
\end{enumerate}

\subsubsection{Môi trường Phát triển Phần mềm cho thiết bị Nhúng}
Việc phát triển phần mềm cho các vi điều khiển như ESP32 đòi hỏi một framework chuyên biệt. \textbf{ESP-IDF (Espressif IoT Development Framework)} được chọn làm môi trường phát triển chính thay vì các IDE như Arduino IDE vì những lý do sau:
\begin{itemize}
    \item \textbf{Hỗ trợ RTOS}: ESP-IDF tích hợp \textbf{FreeRTOS}, cho phép tận dụng tối đa kiến trúc lõi kép của ESP32 để thực hiện đa nhiệm (ví dụ: một tác vụ xử lý dữ liệu IMU thời gian thực, một tác vụ quản lý kết nối Wi-Fi).
    \item \textbf{Truy cập Cấp thấp}: Cho phép truy cập trực tiếp và tối ưu hóa các thanh ghi phần cứng, cần thiết cho việc cấu hình cảm biến IMU (I2C/SPI) và tinh chỉnh các giao thức mạng phức tạp (MQTT/HTTP) ở mức độ chi tiết cao, đảm bảo hiệu suất thời gian thực.
\end{itemize}
Việc lựa chọn môi trường này là nền tảng để xây dựng các mô-đun phần mềm chuyên biệt, sẽ được trình bày chi tiết trong Chương 3.
